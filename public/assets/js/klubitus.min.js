$(function(){$(".ui.dropdown").dropdown()}),function($){$.fn.googleMap=function(options){var defaults={lat:60.1695,"long":24.9355,zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP,marker:!1,infowindow:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};if(options=$.extend(defaults,options||{}),options.city){var geocoder=new google.maps.Geocoder,geocode=(options.address?options.address+", ":"")+options.city;geocoder.geocode({address:geocode},function(results,status){status==google.maps.GeocoderStatus.OK&&results.length&&(options.lat=results[0].geometry.location.lat(),options.long=results[0].geometry.location.lng(),options.marker=!0)})}var center=new google.maps.LatLng(options.lat,options.long),map=new google.maps.Map(this.get(0),$.extend(options,{center:center}));if(options.marker){var marker=new google.maps.Marker({position:center,map:map,title:options.marker?"":options.marker});if(options.infowindow){var infowindow=new google.maps.InfoWindow({content:options.infowindow});google.maps.event.addListener(marker,"click",function(){infowindow.open(map,marker)})}}}}(jQuery),function($){$.fn.dialogify=function(){var href=this.attr("href")||this.attr("data-href");if(!href)return!1;var title=this.attr("data-dialog-title"),width=this.attr("data-dialog-width")||300,height=this.attr("data-dialog-height")||"auto";return $('<div style="display:none"></div>').appendTo("body").dialog({modal:!0,title:title,width:width,height:height,closeText:"â˜“",open:function(){$(this).load(href)},close:function(){$(this).remove()}}),!1}}(jQuery),function($){$.fn.ajaxify=function(url,data,type,success){var $target=$(this);return $.ajax({type:"POST"===(type||"").toUpperCase()?"POST":"GET",url:url,data:data,timeout:2500,beforeSend:function(){$target.loading()}}).done(function(data){$target.replaceWith(data),"function"==typeof success&&success(data)}).fail(function(xhr,status){"error"===status&&(status=xhr.statusText),alert("Fail: "+status),$target.loading(!0)}),this}}(jQuery),function($){$.fn.autocompleteEvent=function(options){var $field=$(this),defaults={eventId:"event_id",limit:25,minLength:3,action:"form",search:"name",field:"id:name:city:stamp_begin:url",order:"stamp_begin.desc",position:{collision:"fit"}};options=$.extend(defaults,options||{}),$field.on("change",function(){"form"==options.action&&$("input[name="+options.eventId+"]")&&$("input[name="+options.eventId+"]").val("")}).on("typeahead:selected",function(event,selection){switch(options.action){case"form":$("input[name="+options.eventId+"]")&&$("input[name="+options.eventId+"]").val(selection.id);break;case"redirect":window.location=selection.url;break;default:"function"==typeof options.action&&options.action(event,selection)}}).typeahead([{limit:options.limit,name:"events",valueKey:"name",remote:{url:"/api/v1/events/search",dataType:"jsonp",beforeSend:function(){$field.closest(".form-group").toggleClass("loading",!0)},replace:function(url,uriEncodedQuery){return url+="?"+$.param({q:decodeURIComponent(uriEncodedQuery),limit:options.limit,filter:options.filter,search:options.search,field:options.field,order:options.order})},filter:function(parsedResponse){return $field.closest(".form-group").toggleClass("loading",!1),parsedResponse.events||[]}},template:function(event){return $.datepicker.formatDate("dd.mm.yy",new Date(1e3*event.stamp_begin))+" "+event.name+", "+event.city}}])}}(jQuery),function($){$.fn.autocompleteGeo=function(options){var defaults={map:"map",country:"fi",lang:"en",latitude:"latitude",longitude:"longitude",limit:10,minLength:3,type:"locality"};options=$.extend(defaults,options||{});var geocoder,autocomplete=$(this).autocomplete({minLength:options.minLength,source:function(request,response){geocoder||(geocoder=new google.maps.Geocoder),geocoder.geocode({address:request.term,region:options.country},function(results,status){if(status==google.maps.GeocoderStatus.OK){var count=0;response($.map(results,function(item){if(count<options.limit&&item.types.indexOf(options.type)>-1){count++;var place=item.formatted_address.split(",");return{label:item.formatted_address,value:place[0].replace(/^[\d ]+/,""),city:place.shift(),description:place.join(","),latitude:item.geometry.location.lat(),longitude:item.geometry.location.lng()}}}))}})},select:function(event,ui){$("input[name="+options.latitude+"]").val(ui.item.latitude),$("input[name="+options.longitude+"]").val(ui.item.longitude)}}).data("autocomplete");autocomplete._renderItem=function(ul,item){var $map=$("<img />").attr({width:100,height:100,alt:"Google Maps",src:"http://maps.googleapis.com/maps/api/staticmap?center="+item.latitude+","+item.longitude+"&zoom=10&size=100x100&sensor=false"});return $('<li class="geocoded" />').data("item.autocomplete",item).append("<a><strong>"+item.city+"</strong><br />"+item.description+"</a>").append($map).appendTo(ul)},autocomplete._renderMenu=function(ul,items){ul.addClass("geocoded");var self=this;$.each(items,function(index,item){self._renderItem(ul,item)})}}}(jQuery),function($,undefined){$.fn.autocompleteUser=function(options){function split(val){return val.split(/,\s*/)}var $field=$(this),defaults={user:0,userId:"user_id",limit:15,minLength:2,maxUsers:1,action:"form",search:"username",field:"id:username:avatar:url",order:"username.asc",position:{collision:"fit"}};options=$.extend(defaults,options||{});var multiple=options.maxUsers>1;multiple?$field.select2({minimumInputLength:options.minLength,multiple:multiple,containerCss:{width:"100%"},tags:multiple||undefined,ajax:{url:"/api/v1/users/search",dataType:"jsonp",data:function(term){return{q:term,user:options.user,limit:options.limit,field:options.field,order:options.order}},results:function(data){return{results:data.users||[],text:"username"}}},createSearchChoice:function(term){return{id:term,username:term}},formatResult:function(user){return~~user.id?(user.avatar?'<img src="'+user.avatar+'" alt="Avatar" width="22" height="22" align="middle"> ':"")+(user.username||""):'<i class="text-muted">'+user.username+"</i>"},formatSelection:function(user){return user.username||""},initSelection:function($element,callback){var tags=$.map(split($element.val()),function(username){return{id:username,username:username}});callback(tags)}}).on("select2-selecting",function(event){switch(options.action){case"form":var $userId=$("input[name="+options.userId+"]");$userId.length&&~~event.val&&$userId.val(event.val)}}):$field.on("typeahead:selected",function(event,selection){switch(options.action){case"form":multiple||($("input[name="+options.userId+"]")&&$("input[name="+options.userId+"]").val(selection.id),$field.val(selection.value));break;case"redirect":var location=$field.attr("data-redirect")||selection.url;$.each(selection,function(key,value){location=location.replace(":"+key,value)}),window.location=location;break;default:"function"==typeof options.action&&options.action(event,selection)}}).typeahead([{limit:options.limit,name:"users",valueKey:"username",remote:{url:"/api/v1/users/search",dataType:"jsonp",beforeSend:function(){$field.closest(".form-group").toggleClass("loading",!0)},replace:function(url,uriEncodedQuery){return url+="?"+$.param({q:decodeURIComponent(uriEncodedQuery),user:options.user,limit:options.limit,search:options.search,field:options.field,order:options.order})},filter:function(parsedResponse){return $field.closest(".form-group").toggleClass("loading",!1),parsedResponse.users||[]}},template:function(user){return'<img src="'+user.avatar+'" alt="Avatar" width="22" height="22" align="middle"> '+user.username}}])}}(jQuery),function($){$.fn.autocompleteVenue=function(){},$.fn.autocompleteVenue=function(options){var $field=$(this),defaults={venueId:"venue_id",cityName:"city_name",latitude:"latitude",longitude:"longitude",limit:25,minLength:1,action:"form",source:[],position:{collision:"fit"}};options=$.extend(defaults,options||{}),$(this).autocomplete({minLength:options.minLength,position:options.position,source:options.source,select:function(event,ui){switch(options.action){case"form":$("input[name="+options.venueId+"]")&&$("input[name="+options.venueId+"]").val(ui.item.id),$("input[name="+options.cityName+"]")&&$("input[name="+options.cityName+"]").val(ui.item.city),$("input[name="+options.latitude+"]")&&$("input[name="+options.latitude+"]").val(ui.item.latitude),$("input[name="+options.longitude+"]")&&$("input[name="+options.longitude+"]").val(ui.item.longitude),$field.val(ui.item.value);break;case"redirect":window.location=ui.item.url;break;default:"function"==typeof options.action&&options.action(event,ui)}}}).data("autocomplete")._renderItem=function(ul,item){return $("<li></li>").data("item.autocomplete",item).append("<a>"+item.label+", "+item.city+"</a>").appendTo(ul)}},$.fn.foursquareVenue=function(options){var defaults={address:"address",latitudeSearch:"city_latitude",longitudeSearch:"city_longitude",latitude:"latitude",longitude:"longitude",venueId:"venue_id",categoryId:"category_id",map:"map",limit:10,position:{collision:"fit"}};options=$.extend(defaults,options||{}),$(this).autocomplete({minLength:2,position:options.position,source:function(request,response){$.ajax({url:"/api/v1/venues/foursquare",dataType:"jsonp",type:"get",data:{method:"venues",ll:$("input[name="+options.latitudeSearch+"]").val()+","+$("input[name="+options.longitudeSearch+"]").val(),limit:options.limit,intent:"match",query:request.term},success:function(data){return data.venues?void response($.map(data.venues.groups[0].venues,function(item){return{id:item.id,label:item.name+", "+item.address,value:item.name,address:item.address,city:item.city,zip:item.zip,lat:item.geolat,"long":item.geolong,category:item.primarycategory?item.primarycategory.id:0}})):!1}})},select:function(event,ui){$("input[name="+options.venueId+"]")&&$("input[name="+options.venueId+"]").val(ui.item.id),ui.item.category&&$("input[name="+options.categoryId+"]")&&$("input[name="+options.categoryId+"]").val(ui.item.category),ui.item.address&&$("input[name="+options.address+"]")&&$("input[name="+options.address+"]").val(ui.item.address),$("input[name="+options.latitude+"]")&&$("input[name="+options.latitude+"]").val(ui.item.lat),$("input[name="+options.longitude+"]")&&$("input[name="+options.longitude+"]").val(ui.item.long),$("#"+options.map).googleMap({marker:!0,lat:ui.item.lat,"long":ui.item.long})}})}}(jQuery),function($){$.fn.notes=function(n){function add(note_data){var scaleX=imageWidth/note_data.imageWidth||1,scaleY=imageHeight/note_data.imageHeight||1,noteX=parseInt(imageOffset.left)+parseInt(note_data.x),noteY=parseInt(imageOffset.top)+parseInt(note_data.y),$note=$('<div class="note" id="note-'+note_data.id+'" />').css({left:noteX*scaleX+"px",top:noteY*scaleY+"px"}),$area=$('<div class="notea" />').css({width:note_data.width*scaleX+"px",height:note_data.height*scaleY+"px"}),$text=$('<div class="notet label label-default" />').append(note_data.url?$('<a href="'+note_data.url+'" class="hoverable">'+note_data.name+"</a>"):note_data.name);$note.append($area).append($text),$image.after($note),$("[data-note-id="+note_data.id+"]")&&$("[data-note-id="+note_data.id+"]").hover(function(){$area.css({visibility:"visible"})},function(){$area.css({visibility:"hidden"})})}var notes=n||{},$image=$(this),imageOffset=$image.position(),imageWidth=$image.width(),imageHeight=$image.height();$(notes).each(function(){add(this)}),$(window).resize(function(){$(".note").remove(),imageOffset=$image.position(),imageWidth=$image.width(),imageHeight=$image.height(),$(notes).each(function(){add(this)})})}}(jQuery);